# Base
- type: entity
  abstract: true
  id: MobIncorporealBase
  name: incorporeal entity
  description: You can't touch it, but it can touch you.
  components:
  - type: FootstepModifier
    footstepSoundCollection:
      path: /Audio/_NF/Effects/silence.ogg
  - type: CanMoveInAir
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeCircle
          radius: 0.4
        density: 10
        mask:
        - FlyingMobMask
        layer:
        - Opaque

# Possessed Toilet
- type: entity
  id: MobMemeGoblinbane
  name: "The Goblinbane"
  parent: [ MobNonHumanHostileBase, MobPassiveRegenWeak, MobHumanoidHostileAIComplex ]
  description: A Daemon of Cleanliness from the time before time (but after the first toilet was built). An ancient enemy of goblinkind.
  categories: [ HideSpawnMenu ]
  components:
  - type: NPCRetaliation
    attackMemoryLength: 90
  - type: Advertise
    pack: goblinbanechatter
    minimumWait: 30
    maximumWait: 120
    nextAdvertisementTime: 10
  - type: Bloodstream
    bloodReagent: Bleach
    chemicalMaxVolume: 100
  - type: NpcFactionMember
    factions:
    - GoblinbaneFaction
  - type: FootstepModifier
    footstepSoundCollection:
      path: /Audio/_NF/Effects/silence.ogg
  - type: CanMoveInAir
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeCircle
          radius: 0.40
        density: 100
        mask:
          - FlyingMobMask
        layer:
          - FlyingMobLayer
  - type: Sprite
    drawdepth: Mobs
    sprite: _NF/Mobs/Meme/goblinbane.rsi
    layers:
    - map: [ "enum.DamageStateVisualLayers.Base" ]
      state: alive
    - map: [ "enum.DamageStateVisualLayers.BaseUnshaded" ]
      state: alive_unshaded
      shader: unshaded
  - type: DamageStateVisuals
    states:
      Alive:
        Base: alive
        BaseUnshaded: alive_unshaded
      Dead:
        Base: dead
        BaseUnshaded: dead_unshaded
  - type: MobThresholds
    thresholds:
      0: Alive
      200: Dead
  - type: Stamina
    critThreshold: 400
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: GlassBreak
      - !type:SpawnEntitiesBehavior
        spawn:
          MobMemeGoblinbaneGhost:
            min: 1
            max: 1
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: MeleeWeapon
    soundHit:
      path: /Audio/Effects/bite.ogg
    damage:
      types:
        Slash: 12
        Structural: 20
    animation: WeaponArcBite
  - type: MeleeChemicalInjector
    solution: bloodstream
    transferAmount: 4
  - type: PointLight
    radius: 1.4
    energy: 1.2
    color: "#ff0000"
  # Ghost role stuff
  - type: GhostRole
    allowMovement: true
    name: ghost-role-information-goblinbane-name
    description: ghost-role-information-goblinbane-description
    rules: ghost-role-information-goblinbane-rules
    raffle:
      settings: default
  - type: GhostTakeoverAvailable
  # Radar console (helps locating goblins and such)
  - type: UserInterface
    interfaces:
      enum.RadarConsoleUiKey.Key:
        type: RadarConsoleBoundUserInterface
  - type: IntrinsicUI
    uis:
      enum.RadarConsoleUiKey.Key:
        toggleAction: ActionObserverShowRadar
  - type: RadarConsole
    followEntity: true
    maxIffRange: 256
    hideCoords: true
  - type: ComplexInteraction
  # Abilities
  - type: Devourer
    foodPreference: Humanoid
    shouldStoreDevoured: true
    chemical: Ichor
    healRate: 15.0
    whitelist:
      components:
      - MobState
      - Door
      tags:
      - Wall
  - type: ActionGun
    action: ActionSpawnCleanlinessDimensionPortal
    gunProto: CleanlinessDimensionPortalGun

- type: entity
  categories: [ HideSpawnMenu ]
  id: ActionSpawnCleanlinessDimensionPortal
  name: "[color=orange]Open Cleanliness Portal[/color]"
  description: "A portal to the dimension of utter cleanliness. No goblins allowed. The ability has [color=yellow]60 second cooldown.[/color]"
  components:
  - type: WorldTargetAction
    icon: { sprite : _NF/Mobs/Meme/goblinbane.rsi, state: bucket_portal }
    event: !type:ActionGunShootEvent
    priority: 2
    checkCanAccess: false
    range: 0
    itemIconStyle: BigAction

- type: entity
  categories: [ HideSpawnMenu ]
  id: CleanlinessDimensionPortalGun
  name: Mop Bucket Portal Gun
  description: Spawns the portal.
  components:
  - type: RechargeBasicEntityAmmo
    rechargeCooldown: 60
    rechargeSound:
      path: /Audio/Magic/fireball.ogg
  - type: BasicEntityAmmoProvider
    proto: SpawnCleanlinessDimensionPortal
    capacity: 1
    count: 1
  - type: Gun
    soundGunshot:
      path: /Audio/Effects/teleport_arrival.ogg
    soundEmpty: null
    projectileSpeed: 5

# Ghost form of possessed toilet
- type: entity
  id: MobMemeGoblinbaneGhost
  parent: [ MobIncorporealBase, MobMemeGoblinbane ]
  suffix: Ghost form
  categories: [ HideSpawnMenu ]
  components:
  - type: NpcFactionMember
    factions:
    - GoblinbaneProvokedFaction
  - type: Bloodstream
    bloodReagent: SoapReagent
    chemicalMaxVolume: 100
  - type: Sprite
    drawdepth: Mobs
    sprite: _NF/Mobs/Meme/goblinbane.rsi
    layers:
    - map: [ "enum.DamageStateVisualLayers.Base" ]
      state: ghost
    - map: [ "enum.DamageStateVisualLayers.BaseUnshaded" ]
      state: ghost_unshaded
      shader: unshaded
  - type: DamageStateVisuals
    states:
      Alive:
        Base: ghost
        BaseUnshaded: ghost_unshaded
      Dead:
        Base: dead
        BaseUnshaded: dead_unshaded
  - type: MobThresholds
    thresholds:
      0: Alive
      200: Dead
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: GlassBreak
      - !type:SpawnEntitiesBehavior
        spawn:
          MobMemePossessedMop:
            min: 1
            max: 2
          MobMemePossessedSpray:
            min: 2
            max: 3
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: BasicEntityAmmoProvider
    proto: SpawnMopBucketDimnsionPortal
    capacity: 1
    count: 1
  - type: Gun
    showExamineText: false
    fireRate: 1
    soundGunshot:
      path: /Audio/Effects/teleport_arrival.ogg
  - type: RechargeBasicEntityAmmo
    rechargeCooldown: 60
    rechargeSound:
      path: /Audio/_NF/Effects/silence.ogg
  - type: MeleeChemicalInjector
    solution: bloodstream
    transferAmount: 10
  # Ghost role stuff
  - type: GhostRole
    allowMovement: true
    name: ghost-role-information-goblinbane-ghost-name
    description: ghost-role-information-goblinbane-description
    rules: ghost-role-information-goblinbane-rules
    raffle:
      settings: default
  - type: GhostTakeoverAvailable

# Possessed Mop
- type: entity
  id: MobMemePossessedMop
  name: possessed mop
  parent: [ MobIncorporealBase, MobMemeGoblinbane ]
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
       task: MeleeFollowerCompound
  - type: NPCImprintingOnSpawnBehaviour
    whitelist:
      components:
      - Devourer
  - type: NpcFactionMember
    factions:
    - GoblinbaneProvokedFaction
  - type: Bloodstream
    bloodReagent: Mopwata
    chemicalMaxVolume: 100
  - type: Sprite
    drawdepth: Mobs
    sprite: _NF/Mobs/Meme/goblinbane.rsi
    layers:
    - map: [ "enum.DamageStateVisualLayers.Base" ]
      state: mop_alive
    - map: [ "enum.DamageStateVisualLayers.BaseUnshaded" ]
      state: mop_unshaded
      shader: unshaded
  - type: DamageStateVisuals
    states:
      Alive:
        Base: mop_alive
        BaseUnshaded: ghost_unshaded
      Dead:
        Base: mop_dead
        BaseUnshaded: mop_dead_unshaded
  - type: MobThresholds
    thresholds:
      0: Alive
      50: Dead
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 50
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: GlassBreak
      - !type:SpawnEntitiesBehavior
        spawn:
          AdvMopItem:
            min: 1
            max: 1
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: MeleeWeapon
    soundHit:
      collection: Punch
    angle: 30
    animation: WeaponArcFist
    attackRate: 1
    damage:
      types:
        Blunt: 6
        Structural: 20
  - type: MeleeChemicalInjector
    solution: bloodstream
    transferAmount: 10
  - type: TimedDespawn
    lifetime: 120

# Possessed Spray
- type: entity
  id: MobMemePossessedSpray
  name: possessed spray
  parent: MobMemeGoblinbane
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
       task: RangedFollowerCompound
  - type: NPCImprintingOnSpawnBehaviour
    whitelist:
      components:
      - Devourer
  - type: NpcFactionMember
    factions:
    - GoblinbaneProvokedFaction
  - type: Bloodstream
    bloodReagent: SpaceCleaner
    chemicalMaxVolume: 50
  - type: Sprite
    drawdepth: Mobs
    sprite: _NF/Mobs/Meme/goblinbane.rsi
    layers:
    - map: [ "enum.DamageStateVisualLayers.Base" ]
      state: spray_alive
    - map: [ "enum.DamageStateVisualLayers.BaseUnshaded" ]
      state: spray_unshaded
      shader: unshaded
  - type: DamageStateVisuals
    states:
      Alive:
        Base: spray_alive
        BaseUnshaded: ghost_unshaded
      Dead:
        Base: spray_dead
        BaseUnshaded: spray_dead_unshaded
  - type: MobThresholds
    thresholds:
      0: Alive
      50: Dead
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 50
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: GlassBreak
      - !type:SpawnEntitiesBehavior
        spawn:
          SprayBottleSpaceCleaner:
            min: 1
            max: 1
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: RechargeBasicEntityAmmo
    rechargeCooldown: 2
    rechargeSound:
      path: /Audio/_NF/Effects/silence.ogg
  - type: BasicEntityAmmoProvider
    proto: SplatterChemCleaner
    capacity: 2
    count: 2
  - type: Gun
    showExamineText: false
    fireRate: 4
    selectedMode: SemiAuto
    availableModes:
    - SemiAuto
    soundGunshot: /Audio/Weapons/Guns/Gunshots/water_spray.ogg
  - type: TimedDespawn
    lifetime: 120

# Possessed Bucket
- type: entity
  id: MobMemePossessedBucket
  name: possessed mop bucket
  parent: [ MobMemeGoblinbane ]
  categories: [ HideSpawnMenu ]
  components:
  - type: HTN
    rootTask:
       task: MeleeFollowerCompound
  - type: NPCImprintingOnSpawnBehaviour
    whitelist:
      components:
      - Devourer
  - type: NpcFactionMember
    factions:
    - GoblinbaneProvokedFaction
  - type: Sprite
    drawdepth: Mobs
    sprite: _NF/Mobs/Meme/goblinbane.rsi
    layers:
    - map: [ "enum.DamageStateVisualLayers.Base" ]
      state: bucket_alive
    - map: [ "enum.DamageStateVisualLayers.BaseUnshaded" ]
      state: bucket_unshaded
      shader: unshaded
  - type: DamageStateVisuals
    states:
      Alive:
        Base: bucket_alive
        BaseUnshaded: bucket_unshaded
      Dead:
        Base: bucket_dead
        BaseUnshaded: ""
  - type: MobThresholds
    thresholds:
      0: Alive
      50: Dead
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 50
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: GlassBreak
      - !type:SpawnEntitiesBehavior
        spawn:
          MopBucket:
            min: 1
            max: 1
          SoapNT:
            min: 1
            max: 1
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: MeleeWeapon
    soundHit:
      collection: Punch
    angle: 30
    animation: WeaponArcFist
    attackRate: 1
    damage:
      types:
        Blunt: 6
        Structural: 20
  - type: TimedDespawn
    lifetime: 120

# Mop bucket dimention portal
- type: entity
  id: MopBucketDimnsionPortal
  name: mop bucket portal
  parent:  [ MobIncorporealBase, CarpStatue ]
  description: A portal to a mop bucket dimension. Obviously. It says so on the label at the corner.
  components:
  - type: NpcFactionMember
    factions:
    - GoblinbaneProvokedFaction
  - type: Timer
  - type: TimedSpawner
    prototypes:
    - SpawnMobMemePossessedBucket
    chance: 1
    intervalSeconds: 20
    minimumEntitiesSpawned: 1
    maximumEntitiesSpawned: 2
  - type: Sprite
    sprite: _NF/Mobs/Meme/goblinbane.rsi
    layers:
    - state: bucket_portal
      shader: unshaded
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 90
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: gib
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 90
      behaviors:
      - !type:DoActsBehavior
        acts: ["Destruction"]
      - !type:PlaySoundBehavior
        sound:
          collection: gib
      - !type:SpawnEntitiesBehavior
        spawn:
          WetFloorSign:
            min: 1
            max: 1
  - type: PointLight
    radius: 2.0
    energy: 3.5
    color: "yellow"
  - type: TimedDespawn
    lifetime: 80

- type: entity
  id: CleanlinessDimensionPortal
  name: cleanliness dimension portal
  parent: MopBucketDimnsionPortal
  description: A portal to the dimension of utter cleanliness. No goblins allowed.
  components:
  - type: TimedSpawner
    prototypes:
    - SpawnRandomPossessedJaniTool
